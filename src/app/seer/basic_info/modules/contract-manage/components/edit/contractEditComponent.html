
<div class="header" *ngIf="currentcontract">
  <button type="button" class="btn btn-default" (click)="cancel()">返回列表</button>
  <button type="button"
          class="btn btn-info"
          [disabled]="showerror&&
          (!currentcontract.contractNumber||!currentcontract.contractName||!currentcontract.contractState
          ||!currentcontract.contractType||!currentcontract.firstParty||!currentcontract.secondParty
          ||!currentcontract.startDate||!currentcontract.endDate||!currentcontract.signDate||!currentcontract.signPerson)"
          (click)="savecontract()">保存
  </button>
  <span class="seer_span_alert" *ngIf="showerror&&
        (!currentcontract.contractNumber||!currentcontract.contractName||!currentcontract.contractState
        ||!currentcontract.contractType||!currentcontract.firstParty||!currentcontract.secondParty
        ||!currentcontract.startDate||!currentcontract.endDate||!currentcontract.signDate||!currentcontract.signPerson)">* 为必须填写项！</span>
</div>


<div class="header_box" *ngIf="currentcontract">
  <div class="row">
    <div class="col-xs-12">
      <label>合同明细</label>
      <div class="col-xs-12 header_border">

      </div>
    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">
      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">合同编号</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.contractNumber}">
        <input class="form-control"  name="contractNumber" type="text" [(ngModel)]="currentcontract.contractNumber"/>
      </div>

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">合同名称</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.contractName}">
        <input class="form-control" name="contractName" type="text" [(ngModel)]="currentcontract.contractName"/>
      </div>

    </div>
  </div>

  <div class="row spbrow">
    <div class="col-xs-12">


      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">当前状态</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.contractState}">
<!--        <select class="form-control" name="sel"
                [(ngModel)]="currentcontract.contractState">
          <option *ngFor="let x of [{key:'00',label:'请选择'},{key:'01',label:'执行中'},{key:'02',label:'结束'}]"
                  [ngValue]="x.key">
            {{x.label}}
          </option>
        </select>-->
        <select class="form-control"
                dict-select
                [key]="'CONTRACT_STATE'"
                name="contractState"
                [selected]="currentcontract.contractState"
                [topOption]="{dictValueId:'',dictValueName:'全部'}"
                [(ngModel)]="currentcontract.contractState"></select>
      </div>


      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">合同类型</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.contractType}">
 <!--       <select class="form-control" name="sel"
                (change)="typeChange(currentcontract.contractType)"
                [(ngModel)]="currentcontract.contractType">
          <option *ngFor="let x of [{key:'0',label:'请选择'},{key:'00',label:'供应商'},{key:'01',label:'客户'}]"
                  [ngValue]="x.key">
            {{x.label}}
          </option>
        </select>-->
        <select class="form-control"
                dict-select
                (change)="typeChange(currentcontract.contractType)"
                [key]="'CONTRACT_TYPE'"
                name="contractType"
                [selected]="currentcontract.contractType"
                [topOption]="{dictValueId:'',dictValueName:'请选择'}"
                [(ngModel)]="currentcontract.contractType"></select>
      </div>
    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">


      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">甲方</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.firstParty}">
        <input class="form-control"   name="firstParty" type="text" [(ngModel)]="currentcontract.firstParty"/>
      </div>

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">乙方</label>
      </div>
      <div class="col-xs-3">
        <div class="form-group">
          <div class="input-group">
            <div [ngClass]="{'has-error': showerror&&!currentcontract.secondParty}" >
              <input class="form-control"  name="secondPartyName" type="text" disabled [(ngModel)]="secondPartyName"/>
            </div>

            <input class="form-control"   name="secondParty" style="display: none" type="text" [(ngModel)]="currentcontract.secondParty"/>
            <supplierClientPicker
              class="input-group-addon"
              style="padding:0"
              [buttonWidth]="'100'"
              (notify)="onSelect($event)"
              [type]="supplierClientType"
            ></supplierClientPicker>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div class="row">
    <div class="col-xs-12">

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">有效期起</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.startDate}">
        <input
          class="form-control"
          [(ngModel)]="currentcontract.startDate"
          close-on-select="true"
          date-only="true"
          name="startDate"
          readonly
          ng2-datetime-picker
        />
      </div>

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">有效期止</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.endDate}">
        <input
          class="form-control"
          [(ngModel)]="currentcontract.endDate"
          close-on-select="true"
          date-only="true"
          name="endDate"
          readonly
          ng2-datetime-picker
        />
      </div>

    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">签订时间</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.signDate}">
        <input
          class="form-control"
          [(ngModel)]="currentcontract.signDate"
          close-on-select="true"
          date-only="true"
          name="signDate"
          readonly
          ng2-datetime-picker
        />
      </div>


      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label required">签订人</label>
      </div>
      <div class="col-xs-3" [ngClass]="{'has-error': showerror&&!currentcontract.signPerson}">
        <input
          type="text"
          class="form-control"
          [(ngModel)]="currentcontract.signPerson"
        />
      </div>


    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label">合同描述</label>
      </div>
      <div class="col-xs-8">
        <textarea rows="3" class="form-control" [(ngModel)]="currentcontract.contractDescribe"></textarea>
      </div>

    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">

      <div class="col-xs-offset-1 col-xs-2">
        <label class="pull-right contract_label">附件</label>
      </div>
      <div class="col-xs-8">

        <div class="col-xs-2">
          <div>
     <!--       <div class="picture-wrapper" (click)="bringFileSelector();">
              <div class="loading" *ngIf="uploadInProgress">
                <div class="spinner">
                  <div class="double-bounce1"></div>
                  <div class="double-bounce2"></div>
                </div>
              </div>
            </div>-->
            <!--      <i class="ion-ios-close-outline" (click)="removePicture();" *ngIf="picture && canDelete"></i>-->
            <!--            <a href class="change-picture" (click)="bringFileSelector();">添加附件</a>-->
            <button type="button" class="btn btn-default" (click)="bringFileSelector()">添加附件</button>
            <input #fileUpload style="display: none" type="file" name="file" hidden="true" id="uploadFile" (change)="onFiles()">
          </div>
        </div>


      </div>

    </div>

    <div class="col-xs-12">
      <div class="col-xs-2">

      </div>
      <div class="col-xs-8" style="max-height: 250px; overflow-y: auto">
        <table class="table table-bordered">
          <tr>
            <th class="text-center"><b>名称</b></th>
            <th class="text-center"><b>操作</b></th>
          </tr>
          <tr *ngFor="let x of currentAttachments; let index=index">
            <td class="text-center">
              <input type="text" class="form-control" [(ngModel)]="x.attachName"/>
            </td>
            <td class="text-center">
              <button type="button" class="btn btn-info btn-xs" (click)="downloadAttach(x)">
                <i class="ion-edit"></i> 查看
              </button>
              <button type="button" class="btn btn-danger btn-xs" (click)="removeAttach(index)">
                <i class="ion-close-round"></i> 删除
              </button>
            </td>
          </tr>
        </table>
      </div>

    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">
      <label>合同品牌</label>
      <div class="col-xs-12 header_border">

      </div>
    </div>
  </div>


  <div class="row spbrow">
    <div class="col-xs-12">
      <button type="button" class="btn btn-info pull-right" (click)="addBrand()">新增品牌</button>
    </div>
    <div class="col-xs-12">
      <table class="table table-bordered">
        <tr>
          <th><b>品牌名称</b></th>
          <th><b>品牌规则</b></th>
          <th class="text-center"><b>操作</b></th>
        </tr>
        <tr *ngFor="let x of contractBrands; let index=index">
          <td class="seertd">
            <select class="form-control special" [(ngModel)]="x.brandId">
              <option *ngFor="let x of currentBrandList"
                      [ngValue]="x.id">
                {{x.brandName}}
              </option>
            </select>
          </td>
          <td class="seertd">
            <select class="special" [(ngModel)]="x.brandRule[0].type" (change)="brandRuleChanged(x.brandRule[0])">
              <option *ngFor="let x of ['规则类型','现金','账期']"
                      [ngValue]="x">
                {{x}}
              </option>
            </select>
            <select class="special" *ngIf="x.brandRule[0].type=='现金'" [(ngModel)]="x.brandRule[0].mode">
              <option *ngFor="let x of ['类型方式','额度']"
                      [ngValue]="x">
                {{x}}
              </option>
            </select>
            <select class="special" *ngIf="x.brandRule[0].type=='账期'" [(ngModel)]="x.brandRule[0].condition">
              <option *ngFor="let x of ['规则条件','天']"
                      [ngValue]="x">
                {{x}}
              </option>
            </select>

            <select class="special"  *ngIf="x.brandRule[0].type=='现金'"   [(ngModel)]="x.brandRule[0].condition">
              <option *ngFor="let x of ['规则条件','等于','上限','下限']"
                      [ngValue]="x">
                {{x}}
              </option>
            </select>
            <input type="text" class="special" [(ngModel)]="x.brandRule[0].value"/>
          </td>
          <td class="text-center seertd">
            <button type="button" class="btn btn-info btn-xs" (click)="openRebateModal(x);staticModal.show()">
              <i class="ion-edit"></i> 返利
            </button>
            <button type="button" class="btn btn-danger btn-xs" (click)="removeBrand(index)">
              <i class="ion-close-round"></i> 删除
            </button>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <!--
    <div class="row spbrow">

      <div class="col-xs-12">

        <button type="button" class="btn btn-default" (click)="cancel()">返回列表</button>
        <button type="button"
                class="btn btn-info"
                [disabled]="!currentcontract.contractNumber"
                (click)="savecontract()">保存
        </button>
      </div>
    </div>-->

</div>


<div class="modal fade" bsModal #staticModal="bs-modal" [config]="{backdrop: 'static'}"
     tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header header_border">
        <button type="button" class="close" aria-label="Close" (click)="staticModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">合同品牌内容详细</h4>
      </div>
      <div class="modal-body">
        <div class="row spbrow">
          <div class="col-xs-12">
            <button type="button" class="btn btn-info pull-right" (click)="addRebate()">新增</button>
          </div>
      <!--    <div class="col-xs-12"  style="margin-bottom: 5px;">
            <div class="col-xs-3">
              <b>返利性质</b>
            </div>
            <div class="col-xs-3">
              <b>返利分类</b>
            </div>
            <div class="col-xs-3">
              <b>返利指标 >(万元)</b>
            </div>
            <div class="col-xs-3">
              <b>返利方式</b>
            </div>
            <div class="col-xs-3">
              <b>返利金额</b>
            </div>
            <div class="col-xs-3">
              <b>开始时间</b>
            </div>
            <div class="col-xs-3">
              <b>结束时间</b>
            </div>
            <div class="col-xs-3">
              <b>操作</b>
            </div>
          </div>
          <div *ngFor="let x of currentBrandRebate; let index=index">
            <div class="col-xs-12">
              <div class="col-xs-3">
       &lt;!&ndash;         <select class="form-control special" [(ngModel)]="x.rebateNation">
                  <option *ngFor="let x of translate.rebateNation"
                          [ngValue]="x.dictValueId">
                    {{x.dictValueName}}
                  </option>
                </select>
                REBATE_NATION&ndash;&gt;
                <select class="form-control"
                        dict-select
                        [key]="'REBATE_NATION'"
                        [selected]="x.rebateNation"
                        [topOption]="{dictValueId:'',dictValueName:'请选择'}"
                        [(ngModel)]="x.rebateNation"></select>
              </div>
              <div class="col-xs-3">
         &lt;!&ndash;       <select class="form-control special" [(ngModel)]="x.rebateType">
                  <option *ngFor="let x of translate.rebateType"
                          [ngValue]="x.dictValueId">
                    {{x.dictValueName}}
                  </option>
                </select>
                REBATE_TYPE&ndash;&gt;
                <select class="form-control"
                        dict-select
                        [key]="'REBATE_TYPE'"
                        [selected]="x.rebateType"
                        [topOption]="{dictValueId:'',dictValueName:'请选择'}"
                        [(ngModel)]="x.rebateType"></select>
              </div>
              <div class="col-xs-3">
                <input type="text" class="form-control" [(ngModel)]="x.rebateTarget"/>
              </div>
              <div class="col-xs-3">
          &lt;!&ndash;      REBATE_MODE
                <select class="form-control special" [(ngModel)]="x.rebateMode">
                  <option *ngFor="let x of translate.rebateMode"
                          [ngValue]="x.dictValueId">
                    {{x.dictValueName}}
                  </option>
                </select>&ndash;&gt;
                <select class="form-control"
                        dict-select
                        [key]="'REBATE_MODE'"
                        [selected]="x.rebateMode"
                        [topOption]="{dictValueId:'',dictValueName:'请选择'}"
                        [(ngModel)]="x.rebateMode"></select>
              </div>
            </div>

            <div class="col-xs-12" style="margin-bottom: 5px;">
              <div class="col-xs-3">
                <input type="text" class="form-control" [(ngModel)]="x.rebateContent"/>
              </div>
              <div class="col-xs-3">
                <input
                  class="form-control"
                  close-on-select="false"
                  date-only="true"
                  readonly
                  [(ngModel)]="x.startTime"
                  ng2-datetime-picker
                />
              </div>
              <div class="col-xs-3">
                <input
                  class="form-control"
                  close-on-select="false"
                  date-only="true"
                  readonly
                  [(ngModel)]="x.endTime"
                  ng2-datetime-picker
                />
              </div>
              <div class="col-xs-3">
                <div class="btn btn-xs btn-danger pull-right"  (click)="removeRebate(index)">
                  <i class="ion-close-round"></i> 删除
                </div>
              </div>
            </div>

          </div>-->
          <div class="col-xs-12">
            <table class="table table-bordered">
              <tr>
                <th width="15%"><b>返利性质</b></th>
                <th width="15%"><b>返利分类</b></th>
                <th width="10%"><b>返利指标 >(万元)</b></th>
                <th width="15%"><b>返利类型</b></th>
                <th width="10%"><b>返利方式</b></th>
                <th><b>开始时间</b></th>
                <th><b>结束时间</b></th>
                <th width="5%"><b>操作</b></th>
              </tr>
              <tr *ngFor="let x of currentBrandRebate; let index=index">
                <td>
                  <select class="form-control special" [(ngModel)]="x.rebateNation">
                    <option *ngFor="let x of translate.rebateNation"
                            [ngValue]="x.dictValueId">
                      {{x.dictValueName}}
                    </option>
                  </select>
                </td>
                <td>
                  <select class="form-control special" [(ngModel)]="x.rebateType">
                    <option *ngFor="let x of translate.rebateType"
                            [ngValue]="x.dictValueId">
                      {{x.dictValueName}}
                    </option>
                  </select>
                </td>
                <td>
                  <input type="text" class="form-control" [(ngModel)]="x.rebateTarget"/>
                </td>
                <td>
                  <select class="form-control special" [(ngModel)]="x.rebateMode">
                    <option *ngFor="let x of translate.rebateMode"
                            [ngValue]="x.dictValueId">
                      {{x.dictValueName}}
                    </option>
                  </select>
                </td>
                <td><input type="text" class="form-control" [(ngModel)]="x.rebateContent"/></td>
                <td>

                    <input
                      class="form-control"
                      close-on-select="true"
                      date-only="true"
                      readonly
                      [(ngModel)]="x.startTime"
                      ng2-datetime-picker
                    />


                </td>
                <td>

                    <input
                      class="form-control"
                      close-on-select="true"
                      date-only="true"
                      readonly
                      [(ngModel)]="x.endTime"
                      ng2-datetime-picker
                    />


                </td>
                <td>
                  <div class="btn btn-xs btn-danger" (click)="removeRebate(index)">
                    <i class="ion-close-round"></i> 删除
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        <div class="row spbrow" style="margin-bottom: 50px;">
          <div class="col-xs-12">
              <button type="button" class="btn btn-default" (click)="staticModal.hide()">取消</button>
              <button type="button"
                      class="btn btn-info"
                      (click)="staticModal.hide();saveRebate()">保存
              </button>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>



